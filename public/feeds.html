<!-- Replace your ENTIRE createPostSection with this -->
<section id="createPostSection" class="content-section active">
  <form id="postForm" enctype="multipart/form-data">
    <!-- Desktop version -->
    <div class="desktop-post-form">
      <div class="post-form-header">
        <img src="images/default-avatar.png" alt="Your avatar" class="post-form-avatar" id="postFormAvatar">
        <div class="post-form-input-wrapper">
          <textarea
            id="postText"
            placeholder="What's on your mind?"
            rows="3"
          ></textarea>
        </div>
      </div>

      <img
        id="preview"
        style="display: none; max-width: 100%; margin-top: 10px; border-radius: 8px;"
        alt="Image Preview"
      />

      <div class="post-form-actions">
        <div class="post-form-options">
          <button type="button" class="post-option-btn photo-btn" onclick="document.getElementById('postImage').click()">
            <i class="fas fa-image photo-icon"></i>
            <span>Photo</span>
          </button>
          <button type="button" class="post-option-btn video-btn">
            <i class="fas fa-video video-icon"></i>
            <span>Video</span>
          </button>
          <button type="button" class="post-option-btn feeling-btn">
            <i class="fas fa-smile feeling-icon"></i>
            <span>Feeling</span>
          </button>
          <button type="button" class="post-option-btn tag-btn">
            <i class="fas fa-user-tag tag-icon"></i>
            <span>Tag</span>
          </button>
        </div>
        <input type="file" id="postImage" accept="image/*" style="display: none;" />
        <button type="submit">Post</button>
      </div>
    </div>

    <!-- Mobile version -->
    <div class="mobile-post-form" style="display: none;">
      <div class="post-input-row">
        <img src="images/default-avatar.png" alt="Your avatar" class="post-form-avatar" id="mobilePostFormAvatar">
        <textarea
          id="mobilePostText"
          placeholder="What's on your mind?"
          rows="1"
        ></textarea>
      </div>

      <img
        id="mobilePreview"
        style="display: none; max-width: 100%; margin-top: 10px; border-radius: 8px;"
        alt="Image Preview"
      />

      <div class="mobile-post-actions">
        <div class="mobile-post-buttons">
          <button type="button" class="mobile-action-btn photo-btn" onclick="document.getElementById('mobilePostImage').click()">
            <i class="fas fa-image"></i>
            <span class="btn-label">Photo</span>
          </button>
          <button type="button" class="mobile-action-btn video-btn">
            <i class="fas fa-video"></i>
          </button>
          <button type="button" class="mobile-action-btn feeling-btn">
            <i class="fas fa-smile"></i>
          </button>
        </div>
        <input type="file" id="mobilePostImage" accept="image/*" style="display: none;" />
        <button type="submit">Post</button>
      </div>
    </div>
  </form>
</section>

<!-- Add this script RIGHT BEFORE the closing </body> tag (at the very end) -->
<script>
  // ===== POST FORM MOBILE/DESKTOP TOGGLE =====
  function updatePostFormVisibility() {
    const desktopForm = document.querySelector('.desktop-post-form');
    const mobileForm = document.querySelector('.mobile-post-form');
    
    if (window.innerWidth <= 768) {
      if (desktopForm) desktopForm.style.display = 'none';
      if (mobileForm) mobileForm.style.display = 'block';
    } else {
      if (desktopForm) desktopForm.style.display = 'block';
      if (mobileForm) mobileForm.style.display = 'none';
    }
  }

  // Initial check
  updatePostFormVisibility();
  window.addEventListener('resize', updatePostFormVisibility);

  // Sync textareas
  const desktopText = document.getElementById('postText');
  const mobileText = document.getElementById('mobilePostText');

  if (desktopText && mobileText) {
    desktopText.addEventListener('input', () => {
      mobileText.value = desktopText.value;
    });

    mobileText.addEventListener('input', () => {
      desktopText.value = mobileText.value;
    });
  }

  // Handle mobile image upload
  const mobileImageInput = document.getElementById('mobilePostImage');
  if (mobileImageInput) {
    mobileImageInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const preview = document.getElementById('mobilePreview');
          const desktopPreview = document.getElementById('preview');
          
          if (preview) {
            preview.src = e.target.result;
            preview.style.display = 'block';
          }
          
          if (desktopPreview) {
            desktopPreview.src = e.target.result;
            desktopPreview.style.display = 'block';
          }
          
          // Also set the desktop file input
          const desktopFileInput = document.getElementById('postImage');
          if (desktopFileInput) {
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            desktopFileInput.files = dataTransfer.files;
          }
        };
        reader.readAsDataURL(file);
      }
    });
  }

  // Handle desktop image upload
  const desktopImageInput = document.getElementById('postImage');
  if (desktopImageInput) {
    desktopImageInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const preview = document.getElementById('preview');
          const mobilePreview = document.getElementById('mobilePreview');
          
          if (preview) {
            preview.src = e.target.result;
            preview.style.display = 'block';
          }
          
          if (mobilePreview) {
            mobilePreview.src = e.target.result;
            mobilePreview.style.display = 'block';
          }
          
          // Also set the mobile file input
          const mobileFileInput = document.getElementById('mobilePostImage');
          if (mobileFileInput) {
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            mobileFileInput.files = dataTransfer.files;
          }
        };
        reader.readAsDataURL(file);
      }
    });
  }

  // Set user avatar when page loads
  function setPostFormAvatars() {
    try {
      const userData = JSON.parse(localStorage.getItem('cyon_user_data') || localStorage.getItem('user') || '{}');
      const avatarUrl = userData.profilePicture || 'images/default-avatar.png';
      
      const desktopAvatar = document.getElementById('postFormAvatar');
      const mobileAvatar = document.getElementById('mobilePostFormAvatar');
      
      if (desktopAvatar) desktopAvatar.src = avatarUrl;
      if (mobileAvatar) mobileAvatar.src = avatarUrl;
    } catch (error) {
      console.error('Error setting avatars:', error);
    }
  }

  // Set avatars when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setPostFormAvatars);
  } else {
    setPostFormAvatars();
  }

  // Also set avatars after a short delay to ensure user data is loaded
  setTimeout(setPostFormAvatars, 500);
</script>
